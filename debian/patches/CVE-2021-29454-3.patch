Backport of: 02633ecaba4a019f583df718345d55aad424e2ac Mon Sep 17 00:00:00 2001
From: Pavel Kochman <kochi@ariaservis.cz>
Date: Fri, 4 Feb 2022 21:03:25 +0100
Subject: [PATCH] math equation return warning: math: illegal character for :
 {math equation="max(x, y)" x=$x y=$y}

---
diff --git a/libs/plugins/function.math.php b/libs/plugins/function.math.php
index fd5b3d166..8560e9441 100644
--- a/libs/plugins/function.math.php
+++ b/libs/plugins/function.math.php
@@ -69,7 +69,7 @@ function smarty_function_math($params, $template)
     // Adapted from https://www.php.net/manual/en/function.eval.php#107377
     $number = '(?:\d+(?:[,.]\d+)?|pi|Ï€)'; // What is a number
     $functionsOrVars = '((?:0x[a-fA-F0-9]+)|([a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*))';
-    $operators = '[+\/*\^%-]'; // Allowed math operators
+    $operators = '[,+\/*\^%-]'; // Allowed math operators
     $regexp = '/^(('.$number.'|'.$functionsOrVars.'|('.$functionsOrVars.'\s*\((?1)+\)|\((?1)+\)))(?:'.$operators.'(?1))?)+$/';
 
     if (!preg_match($regexp, $equation)) {
